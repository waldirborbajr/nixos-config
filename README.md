# My NixOS Configuration â„ï¸

Personal **NixOS workstation configuration**, focused on **simplicity, fast reinstallation, reproducibility and low maintenance**.

This repository is intentionally **not using Home Manager** for configuration management.  
Dotfiles and user-level configs are managed externally via **GNU Stow**, keeping this repo focused on **system-level reproducibility only**.

> Philosophy: *If I reinstall the OS, I want everything I need installed and working â€” nothing more, nothing less.*

---

## âœ¨ Goals

- âš¡ Fast boot and responsive desktop
- ğŸ” Simple and reliable reinstallation
- ğŸ§¹ Automatic cleanup and disk space reduction
- ğŸ§± Clear separation of **system**, **hardware**, **desktop**, and **user**
- ğŸ–¥ï¸ Optimized for **Dell Inspiron** laptops
- ğŸš« No Home Manager dependency
- ğŸ“¦ Deterministic package set (CLI, dev, desktop)

---

## ğŸ“ Repository Structure

```
.
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ build.sh
â”œâ”€â”€ init.sh
â”œâ”€â”€ configuration.nix
â”œâ”€â”€ hardware-configuration.nix
â”œâ”€â”€ modules
â”‚   â”œâ”€â”€ desktop-cosmic.nix
â”‚   â”œâ”€â”€ desktop-gnome.nix
â”‚   â”œâ”€â”€ fonts.nix
â”‚   â”œâ”€â”€ hardware-dell.nix
â”‚   â”œâ”€â”€ kernel-tuning.nix
â”‚   â”œâ”€â”€ maintenance.nix
â”‚   â”œâ”€â”€ maintenance-hm.nix
â”‚   â”œâ”€â”€ packages.nix
â”‚   â”œâ”€â”€ system-packages.nix
â”‚   â”œâ”€â”€ system-programs.nix
â”‚   â””â”€â”€ user-borba.nix
â””â”€â”€ prj
```

---

## ğŸ§© Module Responsibilities

### ğŸ”§ `configuration.nix`
Main entry point. Only **wires modules together** and defines host-level concerns:
- Bootloader
- Hostname
- Docker
- SSH
- Nix settings
- Imports modules

---

### ğŸ–¥ï¸ Hardware

#### `hardware-configuration.nix`
Generated by NixOS. **Do not edit manually**.

#### `modules/hardware-dell.nix`
Dell Inspironâ€“specific hardware:
- Wi-Fi
- Bluetooth
- Audio
- Firmware / microcode
- Power optimizations

---

### âš¡ Kernel & Boot

#### `modules/kernel-tuning.nix`
Performance-focused tuning:
- Faster boot
- Reduced initrd overhead
- Laptop-friendly scheduler & VM tuning

---

### ğŸ¨ Desktop

#### `modules/desktop-gnome.nix`
Default desktop:
- GNOME on Wayland
- GDM auto-login
- Reduced animations
- Fast startup

#### `modules/desktop-cosmic.nix`
Optional **COSMIC Desktop profile**, isolated and swappable.

> Only one desktop module should be imported at a time.

---

### ğŸ”¤ Fonts

#### `modules/fonts.nix`
System-wide fonts:
- JetBrainsMono Nerd Font (primary)
- Emoji + fallback fonts
- Fontconfig defaults

---

### ğŸ“¦ Packages & Programs

#### `modules/system-programs.nix`
Declarative enablement of system programs:
- `zsh`
- `firefox`
- `zoxide`
- Core system services

#### `modules/system-packages.nix`
**Global system packages only**:
- Terminals: `alacritty`, `kitty`
- Shell & multiplexers: `zsh`, `tmux`, `tmuxifier`
- Editors: `neovim`, `lazygit`
- Containers: `docker`, `docker-compose`
- Languages: `go`, `rust`, `nix`
- Toolchains: `gcc`, `clang`, `cmake`, `gdb`, `make`
- CLI tools: `eza`, `bat`, `btop`, `fd`, `ripgrep`, `yazi`
- Browsers: `brave`, `chromium`, `firefox-developer`
- Utilities: `flameshot`, `xclip`, `discord`

Everything here is **machine-wide and reproducible**.

---

### ğŸ‘¤ User

#### `modules/user-borba.nix`
User-specific settings:
- User `borba`
- ZSH shell
- Docker / wheel / network groups
- **Passwordless sudo**
- **Automatic login**
- No user packages (by design)

Dotfiles are managed separately via **GNU Stow**.

---

### ğŸ§¹ Maintenance & Cleanup

#### `modules/maintenance.nix`
Aggressive but safe cleanup:
- Daily GC (`--delete-older-than 2d`)
- Store deduplication
- Disk pressure auto-GC
- Limited system generations

#### `modules/maintenance-hm.nix`
Defensive cleanup of **old Home Manager profiles**, even if HM is not used anymore:
- Weekly cleanup
- Keeps last 3 generations
- Safe no-op if HM is absent

---

## ğŸ› ï¸ Makefile

### Common Commands

```bash
make nixos-rebuild
make nixos-rebuild IMPURE=1
```

### Maintenance

```bash
make rollback
make gc-soft
make gc-hard
```

### Diagnostics

```bash
make doctor
```

`make doctor` performs sanity checks:
- Nix store size
- GC timers
- Disk usage
- Generations
- HM leftovers

---

## ğŸ” Reinstallation Workflow

1. Install NixOS
2. Clone this repo
3. Adjust `hardware-configuration.nix` if needed
4. Run:

```bash
sudo nixos-rebuild switch --flake . --impure
```

5. Restore dotfiles via `stow`

Done.

---

## ğŸ§  Design Decisions

- âŒ No Home Manager (by choice)
- âœ… Stow for dotfiles
- âœ… Aggressive GC (single-user laptop)
- âœ… Clear module boundaries
- âœ… Easy hardware swap
- âœ… Fast boot prioritized over eye candy

---

## ğŸ“š References & Inspiration

- https://github.com/AlexNabokikh/nix-config  
- https://nixos.org/manual  
- https://wiki.nixos.org  

---

## ğŸ Final Notes

This setup is **boring on purpose**.  
Boring means reliable, fast, reproducible â€” and easy to throw away and rebuild.

If you like it, steal it ğŸ˜„

## v1.0.1