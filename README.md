# BORBA JR W – NixOS Configuration ❄️

Personal NixOS workstation configuration focused on clarity, reproducibility, low maintenance, and fast recovery.

This repository intentionally does NOT use Home Manager.
User dotfiles and application-level configuration are managed externally via GNU Stow.

Philosophy:
If I reinstall the OS, everything I need must be installed and working — no manual steps, no leftovers.

---

## Goals

- Fast boot and responsive desktop
- Simple and reliable reinstallation
- Predictable cleanup and disk space control
- Clear separation between system, hardware, desktop, and user
- Laptop-focused workstation (Dell / MacBook)
- No Home Manager
- No flakes
- Deterministic system-wide packages
- Long-term maintainability

---

## Repository Layout

.
├── Makefile
├── README.md
├── build.sh
├── dump.sh
├── init.sh
├── link.sh
├── configuration.nix
├── hardware-configuration-dell.nix
├── hardware-configuration-macbook.nix
├── modules
│   ├── audio.nix
│   ├── autologin.nix
│   ├── base.nix
│   ├── containers
│   │   ├── docker.nix
│   │   ├── k3s.nix
│   │   └── podman.nix
│   ├── desktops
│   │   └── gnome.nix
│   ├── fonts.nix
│   ├── hardware
│   │   ├── dell.nix
│   │   └── macbook.nix
│   ├── networking.nix
│   ├── nixpkgs.nix
│   ├── system-packages.nix
│   ├── users
│   │   └── borba.nix
│   └── virtualization
│       └── libvirt.nix
├── output.txt
└── profiles
    ├── dell.nix
    └── macbook.nix

---

## Architecture

Single entrypoint design.

configuration.nix is the only entrypoint.
It only wires modules together and defines top-level system concerns.

No logic lives in configuration.nix.

---

## Host Profiles

profiles/dell.nix
- Hostname
- Legacy BIOS GRUB bootloader

profiles/macbook.nix
- Hostname
- EFI + systemd-boot

Only one profile must be enabled at a time.

---

## Hardware

hardware-configuration-*.nix files are generated by nixos-generate-config.
They must not be edited manually.

modules/hardware/*
- Firmware and microcode
- Wi-Fi drivers
- Blacklisted kernel modules
- Vendor-specific quirks

---

## Core System

modules/base.nix
- Locale and timezone
- Console keymap
- Experimental Nix features

modules/networking.nix
- NetworkManager
- Faster boot (wait-online disabled)

modules/audio.nix
- PipeWire
- PulseAudio disabled
- ALSA with 32-bit support

modules/fonts.nix
- JetBrainsMono Nerd Font
- Fontconfig defaults

---

## Desktop

modules/desktops/gnome.nix
- GNOME on Wayland
- GDM
- Wayland-native environment variables
- XDG portals

modules/autologin.nix
- Automatic login for user borba

---

## Packages

modules/system-packages.nix defines all system-wide packages.

Includes:
- Terminals
- Shells and multiplexers
- Editors and IDEs
- Containers and Kubernetes tooling
- Languages and compilers
- CLI utilities
- Browsers
- Virtualization tools

Everything is declarative and reproducible.

---

## Containers and Virtualization

Docker
- Enabled as a system service
- Starts on boot

Podman
- Rootless
- Docker-compatible CLI
- Disabled by default

K3s
- Single-node Kubernetes
- Server role
- Traefik and ServiceLB disabled
- Firewall port 6443 open

Libvirt
- QEMU/KVM
- virt-manager support
- Polkit enabled

---

## User

modules/users/borba.nix
- User borba
- ZSH shell
- Groups: wheel, docker, libvirtd, networkmanager
- Passwordless sudo for nixos-rebuild
- Dotfiles managed via GNU Stow

---

## Makefile Usage

This repository must live at:

$HOME/nixos-config

No symlinks to /etc/nixos are used.

Common commands:

make switch
make build
make rollback

Channel management:

make channels

Garbage collection:

make gc-soft
make gc-hard

Store maintenance:

make optimise
make verify

Diagnostics:

make doctor
make generations
make space

---

## Reinstallation Workflow

1. Install NixOS (minimal installer)
2. Clone the repository into $HOME/nixos-config
3. Select the correct host profile in configuration.nix
4. Import the correct hardware-configuration file
5. Run make switch
6. Restore dotfiles using GNU Stow

---

## Design Decisions

- No Home Manager
- No flakes
- Declarative system only
- Explicit maintenance
- Clear module boundaries
- Easy hardware swap
- Repo-based rebuilds (no /etc/nixos)

---

## References

https://nixos.org/manual  
https://wiki.nixos.org  
https://github.com/AlexNabokikh/nix-config  

---

Final Notes

This configuration is boring by design.
Boring means reliable, predictable, reproducible, and disposable.

Version: v1.2.1


GPT: https://chatgpt.com/share/696fa14b-4160-800c-8714-210ff3688f73