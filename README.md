# BORBA JR W ‚Äì NixOS Configuration ‚ùÑÔ∏è

Personal **NixOS workstation configuration**, designed for **clarity, reproducibility, low maintenance, and fast recovery**.

This repository intentionally **does NOT use Home Manager**.  
User dotfiles and application-level configuration are managed externally via **GNU Stow**.

> Philosophy: *If I reinstall the OS, everything I need must be installed and working ‚Äî no manual steps, no leftovers.*

---

## ‚ú® Goals

- ‚ö° Fast boot and responsive desktop
- üîÅ Simple and reliable reinstallation
- üßπ Predictable cleanup and disk space control
- üß± Strong separation between system, hardware, desktop, and user
- üñ•Ô∏è Laptop-focused workstation (Dell / MacBook)
- üö´ No Home Manager dependency
- üì¶ Deterministic system-wide packages
- üõ†Ô∏è Long-term maintainability

---

## üìÅ Repository Layout

```
.
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ build.sh
‚îú‚îÄ‚îÄ dump.sh
‚îú‚îÄ‚îÄ init.sh
‚îú‚îÄ‚îÄ link.sh
‚îú‚îÄ‚îÄ configuration.nix
‚îú‚îÄ‚îÄ hardware-configuration-dell.nix
‚îú‚îÄ‚îÄ hardware-configuration-macbook.nix
‚îú‚îÄ‚îÄ modules
‚îÇ ‚îú‚îÄ‚îÄ audio.nix
‚îÇ ‚îú‚îÄ‚îÄ autologin.nix
‚îÇ ‚îú‚îÄ‚îÄ base.nix
‚îÇ ‚îú‚îÄ‚îÄ containers
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ docker.nix
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ k3s.nix
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ podman.nix
‚îÇ ‚îú‚îÄ‚îÄ desktops
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ gnome.nix
‚îÇ ‚îú‚îÄ‚îÄ fonts.nix
‚îÇ ‚îú‚îÄ‚îÄ hardware
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ dell.nix
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ macbook.nix
‚îÇ ‚îú‚îÄ‚îÄ networking.nix
‚îÇ ‚îú‚îÄ‚îÄ nixpkgs.nix
‚îÇ ‚îú‚îÄ‚îÄ system-packages.nix
‚îÇ ‚îú‚îÄ‚îÄ users
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ borba.nix
‚îÇ ‚îî‚îÄ‚îÄ virtualization
‚îÇ ‚îî‚îÄ‚îÄ libvirt.nix
‚îú‚îÄ‚îÄ output.txt
‚îî‚îÄ‚îÄ profiles
‚îú‚îÄ‚îÄ dell.nix
‚îî‚îÄ‚îÄ macbook.nix
```


---

## üß† Architecture Overview

This repository follows a **single entrypoint model**:

### `configuration.nix`
The **only entrypoint**.  
It wires together:

- Host profile (`profiles/*.nix`)
- Hardware configuration
- Core system modules
- Desktop
- Containers & virtualization
- Users and packages
- Maintenance

> No logic lives here ‚Äî only imports and top-level system concerns.

---

## üñ•Ô∏è Host Profiles

### `profiles/dell.nix`
- Hostname
- Legacy BIOS GRUB bootloader
- Dell-specific identity

### `profiles/macbook.nix`
- Hostname
- EFI + systemd-boot
- MacBook-specific boot configuration

> Only **ONE profile** should be imported at a time.

---

## üß© Hardware

### `hardware-configuration-*.nix`
Generated by `nixos-generate-config`.

‚ö†Ô∏è **Do not edit manually.**

### `modules/hardware/*.nix`
Hardware-specific tuning:
- Firmware and microcode
- Wi-Fi drivers
- Blacklisted kernel modules
- Vendor quirks

---

## ‚öôÔ∏è Core System

### `modules/base.nix`
- Locale and timezone
- Console keymap
- Experimental Nix features (`nix-command`, `flakes` enabled globally)

### `modules/networking.nix`
- NetworkManager
- Faster boot (disable wait-online)

### `modules/audio.nix`
- PipeWire (PulseAudio disabled)
- ALSA + 32-bit support
- RTKit enabled

### `modules/fonts.nix`
- JetBrainsMono Nerd Font
- Fontconfig defaults

---

## üé® Desktop

### `modules/desktops/gnome.nix`
Default desktop environment:

- GNOME on Wayland
- GDM display manager
- Wayland-native variables
- Reduced overhead
- XDG portals enabled

### `modules/autologin.nix`
- Automatic login for user `borba`
- Prevents TTY race conditions

---

## üì¶ Packages

### `modules/system-packages.nix`

System-wide, reproducible packages:

- **Terminals**: alacritty, kitty, gnome-console
- **Shells & tools**: zsh, fish, tmux, stow
- **Editors & IDEs**: neovim (unstable), VS Code (unstable)
- **Containers**: docker, podman, buildah, skopeo
- **Kubernetes**: k3s, k9s, cri-tools
- **Languages**: gcc, clang, go, rustup
- **CLI utilities**: eza, bat, btop, fd, ripgrep, yazi
- **Browsers**: firefox, chromium, brave
- **Virtualization**: virt-manager, qemu, spice

Everything here is **machine-wide** and **fully declarative**.

---

## üê≥ Containers & Virtualization

### Docker
`modules/containers/docker.nix`

- System service
- Enabled on boot
- Integrated with user groups

### Podman (Optional / Future)
`modules/containers/podman.nix`

- Rootless
- Docker-compatible CLI
- Disabled by default
- Fully documented migration path

### K3s
`modules/containers/k3s.nix`

- Single-node Kubernetes
- Server role
- Traefik and ServiceLB disabled
- Firewall configured (6443)

### Libvirt
`modules/virtualization/libvirt.nix`

- QEMU/KVM
- virt-manager support
- Polkit enabled
- Bridge support

---

## üë§ User

### `modules/users/borba.nix`

- User: `borba`
- ZSH shell
- Groups: wheel, docker, libvirtd, networkmanager
- Passwordless sudo for `nixos-rebuild`
- Dotfiles managed externally via **GNU Stow**

---

## üßπ Maintenance Philosophy

Maintenance is **explicit**, **manual**, and **predictable**.

Nothing runs aggressively in the background without intent.

---

## üõ†Ô∏è Makefile (Primary Interface)

This repository is **not** located in `/etc/nixos`.

It is expected to live at:


