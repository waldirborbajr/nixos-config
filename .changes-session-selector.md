# Múltiplas Sessões no GDM - Log de Mudanças

## Problema
Após o refactor, o seletor de sessão do GDM não mostrava mais as opções GNOME e Niri.

## Solução Implementada

### 1. Criado módulo system-level para Niri
**Arquivo**: `modules/desktops/niri/system.nix`
- Habilita `programs.niri` no nível do sistema
- Adiciona xwayland-satellite
- Configura XDG portals para Niri

### 2. Atualizado hosts/macbook.nix
Agora importa ambos os desktops:
```nix
../modules/desktops/gnome.nix
../modules/desktops/niri/system.nix  # Nova linha
```

### 3. Ajustado XDG Portal Configuration
Reorganizado para evitar conflitos:
- `modules/xdg-portal.nix`: Configuração básica com mkDefault
- `modules/desktops/gnome.nix`: Adiciona portal GTK
- `modules/desktops/niri/system.nix`: Adiciona portal GNOME para compatibilidade

### 4. Atualizado documentação
- `modules/desktops/niri/README.md`: Documenta configuração em dois níveis

## Como Testar

1. Construir a configuração:
```bash
make check
make test-build HOST=macbook
```

2. Se passar, aplicar:
```bash
make switch HOST=macbook
```

3. Reiniciar e verificar:
- Na tela de login do GDM, clique no ícone de engrenagem
- Deve aparecer as opções: "GNOME", "Niri", "GNOME (X11)"

## Estrutura do Niri Agora

```
modules/desktops/niri/
├── system.nix          # Sistema: habilita sessão no GDM
├── default.nix         # Home-manager: config do usuário
├── config.nix
├── input.nix
├── output.nix
├── layout.nix
├── keybindings.nix
├── window-rules.nix
├── animations.nix
├── waybar.nix
├── mako.nix
├── fuzzel.nix
└── README.md
```

## Arquivos Modificados

- ✅ `modules/desktops/niri/system.nix` (CRIADO)
- ✅ `hosts/macbook.nix` (import adicionado)
- ✅ `modules/xdg-portal.nix` (simplificado)
- ✅ `modules/desktops/gnome.nix` (portal ajustado)
- ✅ `modules/desktops/niri/README.md` (documentação)

## Se Não Funcionar

Verificar logs:
```bash
journalctl -xeu gdm.service
systemctl status gdm
ls -la /run/current-system/sw/share/wayland-sessions/
ls -la /run/current-system/sw/share/xsessions/
```

Os arquivos .desktop das sessões devem estar nesses diretórios.
